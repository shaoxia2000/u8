<!doctype html>

<html>

<head>
	
	<meta charset="utf-8">
	
	<meta name="description" content="">
	
	<meta name="author" Content="">
	
	<meta name="renderer" content="webkit">
	
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<meta name="apple-mobile-web-app-capable" content="yes">
	
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	
	<title>首页</title>
	{load href="__ASSETS__/bigscr/css/bootstrap.css"}
	{load href="__ASSETS__/bigscr/css/fenbmecss.css"}
	{load href="__ASSETS__/bigscr/js/jquery.min.js"}
	{load href="__ASSETS__/bigscr/js/bootstrap.js"}
	{load href="__ASSETS__/bigscr/js/jquery.leoweather.min.js"}
	<style type="text/css">
		.ce-pack-end {
			display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-box-pack: center;
			position: absolute;
			top: 0;
			left: 0;
		}
		
		.luck-content {
			position: absolute;
			top: 20%;
			bottom: 20%;
			left: 20%;
			right: 20%;
			background: rgba(0, 0, 0, .6);
			padding: 20px;
			border-radius: 5px;
			padding-right: 260px;
		}
		
		.luck-user {
			position: absolute;
			right: 20px;
			top: 20px;
			bottom: 20px;
			width: 240px;
			background-color: rgba(255, 255, 255, .2);
			border-radius: 5px;
		}
		
		.luck-user-list {
			list-style-type: none;
			padding: 0 20px;
			margin: 0;
			overflow-y: scroll;
			position: absolute;
			top: 50px;
			bottom: 70px;
			width: 100%;
		}
		
		.luck-user-list > li {
			margin-top: 10px;
			position: relative;
		}
		
		.luck-user-list > li div.portrait {
			height: 30px;
			width: 30px;
			border-radius: 5px;
			background-position: center;
			background-size: cover;
		}
		
		.luckuserName {
			line-height: 30px;
			position: absolute;
			top: 0;
			left: 40px;
			right: 0;
		}
		
		.luck-user-title {
			position: absolute;
			width: 90%;
			display: block;
			text-align: center;
			line-height: 40px;
			left: 5%;
			color: #f5b43a;
			font-weight: bold;
		}
		
		.luck-user-title::before {
			position: absolute;
			content: "";
			top: 100%;
			left: 0;
			width: 100%;
			background: -webkit-linear-gradient(left, rgba(248, 215, 59, 0), #f0d03a, rgba(248, 215, 59, 0));
			height: 1px;
		}
		
		.luck-user-btn {
			position: absolute;
			bottom: 20px;
			left: 5%;
			width: 90%;
			text-align: center;
			line-height: 40px;
			cursor: pointer;
		}
		
		.luck-user-btn > a {
			background: #f29807;
			width: 100%;
			line-height: 40px;
			display: block;
			border-radius: 5px;
			text-decoration: none;
			color: #fff;
		}
		
		.luck-user-btn > a:hover {
			background: #fcb842;
		}
		
		.luck-title {
			text-align: center;
			margin-bottom: 20px;
		}
		
		.luck-content-btn {
			width: 100%;
			text-align: center;
			line-height: 40px;
			padding-top: 20px;
			overflow: hidden;
		}
		
		.luck-content-btn a {
			background: #f29807;
			width: 150px;
			text-decoration: none;
			display: inline-block;
			color: #fff;
			text-align: center;
			margin: 0 10px;
			cursor: pointer;
		}
		
		.luck-content-btn a:hover {
			background: #fcb842;
		}
		
		.luck-title {
			font-size: 20px;
		}
		
		.slotMachine {
			display: block;
			text-align: center;
			background: #37a3d0;
			width: 310px;
			margin: 0 auto;
			padding: 30px;
			position: relative;
			height: 450px;
			border-radius: 8px;
		}
		
		.slotMachine .slot {
			width: 250px;
			height: 390px;
			background-position: center;
			position: absolute;
		}
		
		.slotMachine .slot > span {
			position: absolute;
			bottom: 0;
			left: 0;
			line-height: 50px;
			text-decoration: center;
			background-color: #fff;
			width: 100%;
			color: #518ab3;
			font-size: 23px;
		}
		
		::-webkit-scrollbar {
			width: 10px;
			height: 16px;
			border-radius: 6px;
		}
		
		::-webkit-scrollbar-track {
			border-radius: 6px;
			background-color: rgba(255, 255, 255, .2);
		}
		
		::-webkit-scrollbar-thumb {
			border-radius: 6px;
			background-color: #fff;
		}
		
		.luck-img {
			width: 100%;
			padding-top: 100%;
			background-position: center;
			background-size: cover;
		}
	</style>
</head>

<body>

<!-- 头部开始 -->

<header class="head">
	
	<div class="col-md-12">
		
		<!-- logo开始 -->
		
		<div class="col-md-8">
			
			<div class="logo_text"><img src="__ASSETS__/bigscr/images/xianzhilogo.png" style="height: 60px;margin-right: 30px;">{$Request.session.area_id|Getareaname}阳光分班现场</div>
		
		</div>
		
		<!-- logo结束 -->
		
		<!-- 时间开始 -->
		
		<div class="col-md-4">
			
			<div class=" times">
				
				<span id="weather"><span id="colock"><strong><span id="weather_YY">2018</span>年<span id="weather_MM">04</span>月<span id="weather_DD">13</span>日 <b class="week">星期<span id="weather_ww">五</span></b></strong></span></span>
				
				<script type="text/javascript">
					
					$('#weather').leoweather({format: '<span id="colock"><strong>{年}年{月}月{日}日 <b class="week">星期{周}</b></strong></span>'});
				
				</script>
			
			</div>
		
		</div>
		
		<!-- 时间结束 -->
	
	</div>


</header>

<!-- 头部结束 -->

<!-- 头部结束 -->

<div class="container-fluid">
	
	<!-- 内容开始 -->
	
	
	<section>
		
		<div class="row">
			
			
			<!-- 学生待分配统计列表开始 -->
			
			<div class="col-md-12">
				
				<div class="con-kuang" style="margin: 10% auto;">
					
					<div class="col-md-6">
						
						<div id="luckuser" class="slotMachine">
							<div class="slot">
								<img src="__ASSETS__/bigscr/images/toux_07.png" style="position: absolute; bottom: 12px; left: 12px;z-index: 9;">
								<span class="name">姓名</span>
							</div>
						</div>
					</div>
					
					<div class="col-md-2">
						
						<ul class="tiao-anniu">
							
							
							<li class="start" id="start" onclick="start()">选定分组人员</li>
							
							
							<li><a href="{:url('bigscr/startthree')}">现场分组开始</a></li>
						
						</ul>
					
					
					</div>
				
				</div>
				
				
				<!-- 学生待分配统计列表结束 -->
			
			</div>
		
		</div>
	
	
	</section>
	
	<!-- 内容结束 -->

</div>

<script type="text/javascript">
	var xinm = {$datahref};
	var phone = {$dataname};
	
	var nametxt = $('.slot');
	var phonetxt = $('.name');
	var pcount = xinm.length - 1;//参加人数
	var runing = true;
	var trigger = true;
	var inUser = (Math.floor(Math.random() * 10000)) % 1 + 1;
	var num = 0;
	var Lotterynumber = 1; //设置单次抽奖人数
	
	$(function () {
		nametxt.css('background-image', 'url(' + xinm[0] + ')');
		phonetxt.html(phone[0]);
	});
	
	// 开始停止
	function start() {
		
		if (runing) {
			
			if (pcount <= Lotterynumber) {
				// alert("抽奖人数不足5人");
			} else {
				runing = false;
				$('#start').text('停止抽选人员');
				startNum()
			}
			
		} else {
			$('#start').text('正在抽取中(' + Lotterynumber + ')');
			zd();
		}
		
	}
	
	// 开始抽奖
	
	function startLuck() {
		runing = false;
		$('#btntxt').removeClass('start').addClass('stop');
		startNum()
	}
	
	// 循环参加名单
	function startNum() {
		num = Math.floor(Math.random() * pcount);
		nametxt.css('background-image', 'url(' + xinm[num] + ')');
		phonetxt.html(phone[num]);
		t = setTimeout(startNum, 100);
	}
	
	// 停止跳动
	function stop() {
		pcount = xinm.length - 1;
		clearInterval(t);
		t = 0;
	}
	
	// 打印中奖人
	
	function zd() {
		if (trigger) {
			
			trigger = false;
			var i = 0;
			
			if (pcount >= Lotterynumber) {
				stopTime = window.setInterval(function () {
					if (runing) {
						runing = false;
						$('#btntxt').removeClass('start').addClass('stop');
						startNum();
					} else {
						runing = true;
						$('#btntxt').removeClass('stop').addClass('start');
						stop();
						
						i++;
						Lotterynumber--;
						
						$('#start').text('正在抽取中(' + Lotterynumber + ')');
						
						if (i == 1) {
							console.log("抽奖结束");
							window.clearInterval(stopTime);
							$('#start').text("重新选择人员");
							Lotterynumber = 1;
							trigger = true;
						}
						;
						
						if (Lotterynumber == inUser) {
							// 指定中奖人
							$('.luck-user-list').prepend("<li><div class='portrait' style='background-image:url(" + xinm[num] + ")'></div><div class='luckuserName'>" + phone[num] + "</div></li>");
							$('.modality-list ul').append("<li><div class='luck-img' style='background-image:url(" + xinm[num] + ")'></div><p>" + phone[num] + "</p></li>");
						} else {
							//打印中奖者名单
							$('.luck-user-list').prepend("<li><div class='portrait' style='background-image:url(" + xinm[num] + ")'></div><div class='luckuserName'>" + phone[num] + "</div></li>");
							$('.modality-list ul').append("<li><div class='luck-img' style='background-image:url(" + xinm[num] + ")'></div><p>" + phone[num] + "</p></li>");
							//将已中奖者从数组中"删除",防止二次中奖
							xinm.splice($.inArray(xinm[num], xinm), 1);
							phone.splice($.inArray(phone[num], phone), 1);
						}
						;
					}
				}, 1000);
			}
			;
		}
	}
</script>

</body>

</html>



